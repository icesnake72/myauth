# ================================================
# 개발용 중앙 MySQL 서버
# 여러 프로젝트에서 공유 사용
# ================================================
#
# 사용법:
# 1. 이 파일을 공통 디렉토리에 배치 (예: ~/development/shared-infrastructure/)
# 2. docker-compose -f docker-compose-mysql-only.yml up -d
# 3. 각 프로젝트에서 localhost:3306으로 연결
#
# ================================================

version: '3.8'

services:
  mysql:
    image: mysql:8
    container_name: dev-mysql  # 고정 이름 사용

    ports:
      - "3306:3306"  # 호스트 포트 노출

    environment:
      MYSQL_ROOT_PASSWORD: 1234
      TZ: Asia/Seoul

    # 데이터 보존
    volumes:
      - /Users/eunbumkim/datadir:/var/lib/mysql
      # 또는 Docker volume 사용:
      # - mysql-data:/var/lib/mysql

    # 헬스체크
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p1234"]
      interval: 10s
      timeout: 3s
      retries: 5

    # 항상 실행 유지
    restart: unless-stopped

# volumes:
#   mysql-data:  # Docker volume 사용 시 주석 해제

# ================================================
# 사용 방법
# ================================================
#
# 1. MySQL 서버 시작 (한 번만)
#    docker-compose -f docker-compose-mysql-only.yml up -d
#
# 2. 데이터베이스 생성
#    docker exec -it dev-mysql mysql -u root -p
#    > CREATE DATABASE myauth;
#    > CREATE DATABASE blog;
#    > CREATE DATABASE shop;
#    > exit;
#
# 3. 각 프로젝트에서 연결
#    DB_URL=jdbc:mysql://localhost:3306/myauth
#    DB_URL=jdbc:mysql://localhost:3306/blog
#    DB_URL=jdbc:mysql://localhost:3306/shop
#
# 4. MySQL 중지 (개발 완료 시)
#    docker-compose -f docker-compose-mysql-only.yml stop
#
# 5. MySQL 재시작
#    docker-compose -f docker-compose-mysql-only.yml start
#
# ================================================
